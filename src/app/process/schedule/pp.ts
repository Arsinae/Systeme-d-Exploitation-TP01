import { Schedule } from './schedule';

export class PPSchedule extends Schedule {

  setRunning(current, timeIndex) {
    let waiting = {index: -1, priority: -1};
    for (let i = 0; i < this.processes.length; i++) {
      if (current.processState[i] === 'waiting' &&
      (waiting.index === -1 || this.processes[i].priority > waiting.priority)) {
        waiting = {index: i, priority: this.processes[i].priority};
      }
    }
    if (waiting.index !== -1) {
      return {processIndex: waiting.index, end: timeIndex + this.processes[waiting.index].duration};
    } else {
      return {processIndex: -1, end: 0};
    }
  }

  actionOnEndProcess(current, time) {
    for (let i = 0; i < current.processState.length; i++) {
      if (current.processState[i] === 'waiting' && time !== this.processes[i].arrivedTime) {
        this.processes[i].priority += 1;
      }
    }
  }
}
